<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>areaDetector FastCCD Driver</title>
  <meta content="text/html; charset=ISO-8859-1" http-equiv="Content-Type" />
</head>
<body>
		<h1 align="center">
areaDetector FastCCD driver
</h1>
<h2 align="center">
December 20th, 2018
</h2>
<h2 align="center">
Stuart B. Wilkins
</h2>
<h2 align="center">
NSLS-II, Brookhaven National Laboratory
</h2>
<h2 id="contents">Contents</h2>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#implementation-of-standard-driver-parameters">Implementation of standard driver parameters</a></li>
<li><a href="#fastccd-specific-parameters">FastCCD specific parameters</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#setting-the-image-size">Setting the image size</a></li>
<li><a href="#medm-screens">MEDM screens</a></li>
<li><a href="#connection-management">Connection management</a></li>
</ul>
<h2 id="overview">Overview</h2>
<p>This is an <a href="http://www.aps.anl.gov/epics/">EPICS</a> <a href="areaDetector.html">areaDetector</a> driver for the FastCCD detector produced by the detector group at Lawrence Berkely National Laboratory. The driver is supported under Linux. The driver acts as a high level driver over a lower level c-driver which communicates with the camera via UDP sockets. The lower level c driver, <em>libcin</em> can be found <a href="https://github.com/NSLS-II/libcin">on github here</a>.</p>
<p>This driver inherits from <a href="areaDetectorDoc.html#ADDriver">ADDriver</a>. It implements nearly all of the parameters in <a href="areaDetectorDoxygenHTML/asyn_n_d_array_driver_8h.html">asynNDArrayDriver.h</a> and in <a href="areaDetectorDoxygenHTML/_a_d_driver_8h.html">ADArrayDriver.h</a>. It also implements a number of parameters that are specific to the FastCCD camera and can controll the boot-up sequence of the camera amd all settings such as bias voltages and timing.</p>
<h2 id="implementation-of-standard-driver-parameters">Implementation of standard driver parameters</h2>
<p>The driver redefines the choices for several of the parameters defined in ADDriver.h. The ADTriggerMode choices for the FastCCD are:</p>
<ul>
<li>Internal (Software trigger)</li>
<li>External 1 (external trigger on input 1)</li>
<li>External 2 (external trigger on input 2)</li>
<li>External 1+2 (external trigger on input 1 OR input 2)</li>
</ul>
<p>The NDDataType choices for the FastCCD are:</p>
<ul>
<li>NDUInt16 (16 bit data)</li>
</ul>
<p>The NDColorMode choices for the FastCCD are:</p>
<ul>
<li>NDColorModeMono (monochromatic data)</li>
</ul>
<h2 id="fastccd-specific-parameters">FastCCD specific parameters</h2>
<p>The FastCCD driver implements the following parameters in addition to those in asynNDArrayDriver.h and ADDriver.h:</p>
<table border="1" cellpadding="2" cellspacing="2" style="text-align: left">
<tr>
<td colspan="7" align="center">
<b> Parameter Definitions in FastCCD.cpp and EPICS Record Definitions in FastCCD.template </b>
</td>
</tr>
<tr>
<td>
Parameter index variable
</td>
<td>
asyn interface
</td>
<td>
Access
</td>
<td>
Description
</td>
<td>
drvInfo string
</td>
<td>
EPICS record name
</td>
<td>
EPICS record type
</td>
<tr>
<tr>
<td colspan="7" align="center">
<b> FastCCD Image Size and Overscan Settings </b>
</td>
</tr>
<tr>
<td>
FastCCDOverscanRows
</td>
<td>
asynParamInt32
</td>
<td>
r/w
</td>
<td>
Specify the number of overscan rows to use when descrambling
</td>
<td>
OVERSCAN_ROWS
</td>
<td>
<span class="math inline">(<em>P</em>)</span>(R)OverscanRows<br /><span class="math inline">(<em>P</em>)</span>(R)OverscanRows_RBV
</td>
<td>
longout<br />longin
</td>
<tr>
<tr>
<td>
FastCCDOverscanCols
</td>
<td>
asynParamInt32
</td>
<td>
r/w
</td>
<td>
Specify the number of overscan columns to use when descrambling
</td>
<td>
OVERSCAN_COLS
</td>
<td>
<span class="math inline">(<em>P</em>)</span>(R)OverscanCols<br /><span class="math inline">(<em>P</em>)</span>(R)OverscanCols_RBV
</td>
<td>
longout<br />longin
</td>
<tr>
</table>
<h2 id="configuration">Configuration</h2>
<p>The FastCCD driver is created with the FastCCDConfig command, either from C/C++ or from the EPICS IOC shell.</p>
<pre><code>int FastCCDConfig(char *portName, 
                  int maxBuffers, size_t maxMemory,
                  int priority, int stackSize,
                  int packetBuffer, int imageBuffer,
                  const char *baseIP, const char *fabricIP, 
                  const char *fabricMAC)</code></pre>
<p>The <strong>packetBuffer</strong> and <strong>imageBuffer</strong> parameters specify how many packet frames and images to buffer in the <code>libcin</code> driver. These are directly passed to <code>libcin</code> on initialization.</p>
<p>The <strong>baseIP</strong> and <strong>fabricIP</strong> are the ip addresses of the base and fabric interfaces on the camera interface node (CIN). A null &quot;&quot; string sets the default as defined in the <code>libcin</code> driver.</p>
<p>The <strong>fabricMAC</strong> parameter causes the <code>libcin</code> driver to set the MAC address of the CIN on initialization. This can be used to broadcast the image data by using the <code>FF:FF:FF:FF:FF</code> mac address.</p>
<p>For details on the meaning of the other parameters to this function refer to the detailed documentation on the FastCCDConfig function in the <a href="areaDetectorDoxygenHTML/_fast_c_c_d_8cpp.html">FastCCD.cpp documentation</a> and in the documentation for the constructor for the <a href="areaDetectorDoxygenHTML/class_fast_c_c_d.html">FastCCD class</a>.</p>
<h2 id="setting-the-image-size">Setting the image size</h2>
<p>Due to the multicolum nature of the FastCCD, setting the image size is not trivial. This is due to the nature of the image descrambling and if overscan is used on each supercolumn. For this reason the image size is governed by two paramaters, <code>$(P)$(R)OverscanCols</code> and <code>$(P)$(R)ADSizeY</code>.</p>
<p>The definition used for the image orientation in this driver is that columns are along the <em>X</em> direction and rows are along the <em>Y</em> direction. As the number of columns per <em>supercolumn</em> is fixed in timing to 10 columns, the only free parameter is the number of overscan cols to include and specified by the <code>$(P)$(R)OverscanCols</code> PV. For this reason setting of the <code>$(P)$(R)ADSizeX</code> PV is ignored by the driver. The number of rows defines how many rows per column to process and is set by the <code>$(P)$(R)ADSizeY</code> PV.</p>
<p>The actual image size is therefore given by:</p>
<ul>
<li><em>X</em> Direction (row wise) <code>$(P)$(R)ADSizeY</code> [usually set to 2000 to have some overscan]</li>
<li><em>Y</em> Direction (column wise) (10 + <code>$(P)$(R)OverscanCols</code>) * 96 [for no overscan 960]</li>
</ul>
<h2 id="medm-screens">MEDM screens</h2>
<p>MEDM screens are not used at NSLS-II as CSS-BOY is the default display manager</p>
<h2 id="connection-management">Connection management</h2>
<p>As the FastCCD <em>CIN</em> only uses UDP sockets, there is no permanent connection, the driver relies on being able to read such parameters as the serial nnumber of the software to be able to confirm that commuincation with the driver is occuring.</p>
	</body>
</html>
